<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>

<main id="mainContainer" class="row">
    <container class="col-2">
        <container class="row">
        <form id="weather-form">
            <label for="locationInput"><strong><h2>Search for a city:</h2></strong></label>
            <input type="text" id="locationInput" placeholder="Las Vegas">
        <!-- This button will trigger our AJAX call -->
            <input id="searchButton" type="submit" value="Search"></input>
        </form>
        
        <div id="History-goes-here" class="row"></div>

    </container>
    </container>

    <container class="col-10">
    <div class="row">
    <div class="col-12">
    <ul>
    <div id="currentResults"></div>
    </ul>

    <div id="UV-index-results-here" class="row"></div>
    </container>
</main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">

        let userCityArray = JSON.parse(localStorage.getItem("cities")) || []
        console.log(userCityArray[0]);
        $("#searchButton").on("click", function(event) {

        // event.preventDefault() can be used to prevent an event's default behavior.
        // Here, it prevents the submit button from trying to submit a form when clicked
        event.preventDefault();

        // $(document).ready(function () {
            var searchBtn = $("#searchButton");

            // searchBtn.on("click", function() {
            var cityName = $("#locationInput").val().trim();
            console.log(cityName);
            var queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + cityName + "&appid=1b5e9096e8f25e04ccd2e1d65aa7ae08";
            // var fiveDayForecast = "http://api.openweathermap.org/data/2.5/forecast/daily?q=" + cityName + "&appid=1b5e9096e8f25e04ccd2e1d65aa7ae08";
            
            $("#History-goes-here").empty();
            userCityArray.push(cityName);
            console.log(userCityArray)
            localStorage.setItem("cities",JSON.stringify(userCityArray))

            for (let i = 0; i < userCityArray.length; i++) {
                let citiesDiv = $("<p>");
                citiesDiv.addClass("historyBlock")
                citiesDiv.prepend(userCityArray[i])
                $("#History-goes-here").prepend(citiesDiv);
            }

        $.ajax({
            url: queryURL,
            method: "GET"
        }).then(function(response) {

        console.log(response);

            var lat = response.coord.lat
            console.log(lat);
            var lon = response.coord.lon
            console.log(lon);

            var ForecastIndexQueryURL = "https://api.openweathermap.org/data/2.5/onecall?lat=" + lat + "&lon=" + lon + "&exclude=minutely,hourly" + "&units=imperial" + "&appid=1b5e9096e8f25e04ccd2e1d65aa7ae08";

        $.ajax({
            url: ForecastIndexQueryURL,
            method: "GET"
        }).then(function(res) {
            console.log(res);

        $("#currentResults").empty();
        
            let currentRes = res.current;
            let currentDiv = $("<div>");
            let currentIconArray = currentRes.weather[0].icon;
            console.log(currentIconArray);
            let currentWeatherIcon = "http://openweathermap.org/img/w/" + currentIconArray + ".png";
            console.log(currentWeatherIcon)


            let userCity = $("<header>").html("<h1>" + cityName + "</h1>");
            userCity.css("display", "inline-block");
            let currentIcon = $("<img>").attr('src', currentWeatherIcon);
            currentIcon.css("display", "inline-block");
            let currentTemp = $("<li>").text("Temperature: " + currentRes.temp);
            let currentHumidity = $("<li>").text("Humidity: " + currentRes.humidity);
            let currentWindSpeed = $("<li>").text("Wind Speed: " + currentRes.wind_speed);
            let currentUVId = $("<li>").text("UV Index: " + currentRes.uvi);

            currentDiv.append(userCity, currentIcon, currentTemp, currentHumidity, currentWindSpeed, currentUVId);


            $("#currentResults").append(currentDiv);

            
            console.log(res);
            var results = res.daily;
            $("#UV-index-results-here").empty();
            // Looping through each result item
            for (var i = 0; i < 5; i++) {

                // Creating and storing a div tag
                var forecastDiv = $("<div>");
                forecastDiv.addClass("col-md forecast-div")

                var iconArray = results[i].weather[0].icon;
                console.log(iconArray);
                var weatherIcon = "http://openweathermap.org/img/w/" + iconArray + ".png";
                console.log(weatherIcon);
                var iconDisplayed = $("<img>").attr('src', weatherIcon)

                // Creating a paragraph tag with the result item's rating
                var dailyTemp = $("<p>").text("Temperature: " + results[i].temp.day);
                var dailyHumidity = $("<p>").text("Humidity: " + results[i].humidity);
                // Appending the paragraph and image tag to the animalDiv
                forecastDiv.append(iconDisplayed);
                forecastDiv.append(dailyTemp);
                forecastDiv.append(dailyHumidity);

                $("#UV-index-results-here").append(forecastDiv);
            }

        })
        .catch(err=>console.log(err))
        

        
            // //User clicks on save button
            // $('#searchButton').on('click', saveToLocalStorage);

            // function saveToLocalStorage() {
            //         localStorage.setItem(whatToDoHour, whatToDo);
            //     });
            // };
        

    });

    // $.ajax({
    //       url: fiveDayForecast,
    //       method: "GET"
    //     }).then(function(resp) {


    
        // });

});



</script>

    
</body>
</div>
</html>